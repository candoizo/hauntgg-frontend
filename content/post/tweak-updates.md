---
  title: "Recent Tweak Updates"
  date: 2021-01-13 17:22:43-0400
  description: RideTheLightning vulnerability research
  tags:
  - ios
  - jailbreak
  image: "email.png"
  draft: false
---

A small update of some tweaks (Bolders, MASQKit) to christen my new and improved blahg.

#### Tested on:

- iPhone 7+ iOS 14.2
- iPhone X iOS 13.5

## Bolders

This tweak provides fullscreen folders! It has been tested on

## MASQKit + Friends


## masq.app/



DNS [can](https://apple.com) be frustrating to `manage` in tandem with OpenVPN when the goal is to avoid revealing information about the websites being visited. Since [most sources](https://duckduckgo.com) of internet you pair with broadcast their own DNS resolver that it will be connected much more directly to the Internet relative to you vs. a server running OpenVPN far away giving it near-instant resonse time, so when the computer thinks your VPN's DNS is going slow it might ask the second resolver on the list hoping for a faster reply.

## Doodle of the path

This is a benefit to browsing in most cases because it greatly lowers the time it can take to visit new domains by hundreds of milliseconds mostlys since DNS queries are still made without encryption over port 53 with minimal overhead. Unfortunately for anyone trying to protect browsing activity this builds a history of the time and order of all sites queried to the DNS resolver sorted by the individual IP and MAC address.

## Put picture of pihole query log here to demonstrate

DNS over HTTPS/TLS clients like `dohclient` or `cloudflared` are a promising solutions for Linux to the eavesdropping potential these pose because the provide more privacy by wrapping a DNS lookup in HTTPS but introduces more communication due to the 4-way handshake that adds latency. With one of these clients configured you can mask the destination of all your domains under your upstream resolver. If you want to setup `cloudflared` with `systemd` I have a play for `ansible` here. In a moment I will demonstrate the difference in query response time you can expect.

Another way of introducing latency is to run a resolver on your OpenVPN server or have this included by your service provider. The benefit this offers is all of your DNS queries will now be indiscernable from your OpenVPN packets and encrypted when snooped along the way but must make the round trip adding latency.

And even still often the computer has no choice to but listen to the router and will have a final pesky entry under `/etc/resolv.conf` that keeps track of the DNS assigned by the router, and it probably is the fastest resolver aviable that you don't have to run on your computer.

We can test the difference in speed using the `dig` or `drill` commands. Using syntax like so:

```cmd {linenos=false}
$> cat /etc/resolv.conf
# Generated by resolvconf
nameserver 10.8.0.1
nameserver 172.20.10.2

$> drill apple.com @10.8.0.1
*snip*
;; Query time: 218 msec
;; SERVER: 10.8.0.1

$> drill apple.com @172.20.10.2
*snip*
;; Query time: 93 msec
;; SERVER: 172.20.10.2
 ```

Above you can see I check `/etc/resolv.conf` for my system's current DNS resolvers, and fire out to lookups for the IP address assigned to the DNS records of apple.com. The `10.8.0.1` is the IP address of a OpenVPN server I'm running on the Google Cloud Engine while `192.168.2.1` is the router of the local ISP.

When this happens those who are running the DNS resolver can see these requests I have made for an IP address assigned to Apple.com in plaintext, the MAC address and local IP of the device that made the request (both you can find with `ip addr show`) what devices visited what website at what time and thus degrade the privacy of your connection. By forcing DNS queries over the VPN, our lookups will be transmitted over encrypted packets to the vpn's resolver and indiscernable from your regular VPN traffic to those listenin along the way.

A small change to the update-resolv-conf script that I found to be widely suggested helped me avoid this frustrating situation. To help illustrade the difference I have marked the lines and will go over the script. We can see in the header is tells us arguments are passed to it by OpenVPN like:

```cmd {linenos=false}
$> bash /etc/openvpn/update-resolv-conf foreign_option_1='dhcp-option DNS 193.43.27.132'
```


It takes the first 3 arguments and stores them as `partX=$X`, parses these `foreign_option_*` variables for nameservers and searchdomains (searchdomains being the part of DNS that lets you visit `$HOST.localdomain`) but irrelevant to us at this time.

It then loops through the NMSERVERS and appends them to /etc/resolv.conf.

Our change is simple and would work with `iptables` or `ufw`. With some bash-fu we can read the last domain which is generally that of our router and block the DNS port when new ones are added or remove the block once our VPN connection is severed.

After saving the changes use `ufw status numbered` to view the rules and firewall status. If enabled you should now restart your OpenVPN client connection to trigger our changed `update-resolv-conf`.

Once restarted lets check our rules again and in the ideal case we should now see


```cmd {linenos=false}
$> sudo ufw status
Status: active

To                         Action      From
--                         ------      ----
172.20.10.2 53             DENY OUT    Anywhere
```


This confirms that all of our packets will not reach. Ee can confirm it's working by firing out a request with `drill apple.com @172.20.10.2` and it should hang indefinitly. With logging enabled on `ufw` we can find another good sign in our log with `dmesg -k | grep BLOCK.\*53`

```shell {linenos=false}
#  check log, filter for blocks with 53 after, print the last one
$> dmesg -k | grep "BLOCK.\*=53" | tail -n 1
[91441.507197] [UFW BLOCK] IN=tun0 OUT= MAC= SRC=10.8.0.3 DST=10.8.0.4 LEN=40 TOS=0x00 PREC=0x00 TTL=64 ID=0 DF PROTO=TCP SPT=61593 DPT=53 WINDOW=0 RES=0x00 RST URGP=
#      grep start _/                          |            |                                                                   grep end_/
#               Client issuing the request  _/              \_ DNS server points at our remote server
```


Now that we are safe from DNS leaks, its up to you to choose to layer on DoH with your VPN. Doing so adds latency but greatly improves the privacy of your browsing.
